- name: Check if this Red Hat is subscribed to something
  hosts: all
  gather_facts: true
  
  tasks:
  - name: "check if package is installed on Red Hat family"
    yum:
      name: insights-client
      state: present
    when: ansible_facts['os_family'] == "RedHat"

    
  - name: Check registration command
    shell: --register --display-name=${HOSTNAME} --force-reregister
    register: command_result
    failed_when: command_result.rc != 0
    changed_when: false
    when: ansible_facts['os_family'] == "RedHat"
    
  - name: Resultados
    debug:
      msg: "{{command_result.stdout.split('\n')}}"
    when: ansible_facts['os_family'] == "RedHat"
